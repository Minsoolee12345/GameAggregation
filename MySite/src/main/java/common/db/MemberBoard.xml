<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.ac.kopo.dao.MemberDAO">

    <!-- Result Map 정의 -->
    <resultMap id="memberResultMap" type="kr.ac.kopo.vo.MemberVO">
        <id property="id" column="id" />
        <result property="name" column="name" />
        <result property="password" column="password" />
        <result property="emailId" column="email_id" />
        <result property="emailDomain" column="email_domain" />
        <result property="type" column="type" />
        <result property="regDate" column="reg_date" />
    </resultMap>

    <!-- 로그인 처리 (일반 사용자 및 관리자 전용) -->
    <select id="login" parameterType="map" resultMap="memberResultMap">
        SELECT *
        FROM t_member
        WHERE id = #{id} 
          AND type IN ('user', 'admin')
          AND password = #{password}
    </select>

    <!-- 회원 가입 -->
    <insert id="insertMember" parameterType="kr.ac.kopo.vo.MemberVO">
        INSERT INTO t_member (id, name, password, email_id, email_domain, type, reg_date)
        VALUES (#{id}, #{name}, #{password}, #{emailId}, #{emailDomain}, #{type}, SYSDATE)
    </insert>

    <!-- 회원 정보 조회 -->
    <select id="findById" parameterType="string" resultMap="memberResultMap">
        SELECT *
        FROM t_member
        WHERE id = #{id}
    </select>

    <!-- 아이디 중복 체크 -->
    <select id="countById" parameterType="string" resultType="int">
        SELECT COUNT(*)
        FROM t_member
        WHERE id = #{id}
    </select>

    <!-- 회원 정보 수정 -->
    <update id="updateMember" parameterType="kr.ac.kopo.vo.MemberVO">
        UPDATE t_member
        SET password = #{password}, 
            email_id = #{emailId}, 
            email_domain = #{emailDomain}, 
            name = #{name},
            type = #{type}
        WHERE id = #{id}
    </update>

    <!-- 회원 탈퇴 -->
    <delete id="deleteMember" parameterType="string">
        DELETE FROM t_member
        WHERE id = #{id}
    </delete>

    <!-- 전체 회원 조회 -->
    <select id="selectAllMembers" resultMap="memberResultMap">
        SELECT *
        FROM t_member
    </select>
</mapper>
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- GameDAO -->
<mapper namespace="kr.ac.kopo.dao.GameDAO">

    <resultMap id="gameMap" type="kr.ac.kopo.vo.GameVO">
        <id property="gameId" column="game_id" />
        <result property="gameUrl" column="game_url" />
        <result property="gameTitle" column="game_title" />
        <result property="gameIntro" column="game_intro" />
    </resultMap>

    <!-- 모든 게임 조회 -->
    <select id="selectAllGames" resultMap="gameMap">
        SELECT game_id, game_url, game_title, game_intro
        FROM t_game
    </select>

    <!-- 특정 게임 조회 -->
    <select id="selectGameById" parameterType="int" resultMap="gameMap">
        SELECT game_id, game_url, game_title, game_intro
        FROM t_game
        WHERE game_id = #{gameId}
    </select>

    <!-- 게임 추가 -->
    <insert id="insertGame" parameterType="kr.ac.kopo.vo.GameVO">
        INSERT INTO t_game (game_url, game_title, game_intro)
        VALUES (#{gameUrl}, #{gameTitle}, #{gameIntro})
    </insert>

    <!-- 게임 삭제 -->
    <delete id="deleteGame" parameterType="int">
        DELETE FROM t_game
        WHERE game_id = #{gameId}
    </delete>

    <!-- 게임 검색 (gameTitle 및 gameIntro 기준) -->
    <select id="searchGames" parameterType="string" resultMap="gameMap">
        SELECT game_id, game_url, game_title, game_intro
        FROM t_game
        WHERE game_title LIKE CONCAT('%', #{query}, '%')
           OR game_intro LIKE CONCAT('%', #{query}, '%')
        ORDER BY game_title ASC
        LIMIT 10
    </select>

    <!-- 게시글 번호를 통해 게임 타이틀 조회 (게시글과 게임 조인)-->
    <select id="selectGameTitleByBoardNo" parameterType="int" resultType="string">
        SELECT g.game_title
        FROM t_board b
        JOIN t_game g ON b.game_id = g.game_id
        WHERE b.no = #{boardNo}
    </select>
</mapper>

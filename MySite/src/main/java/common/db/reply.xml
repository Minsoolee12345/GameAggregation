<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- ReplyDAO -->
<mapper namespace="kr.ac.kopo.dao.ReplyDAO">

    <resultMap id="ReplyResultMap" type="kr.ac.kopo.vo.ReplyVO">
        <id property="replyNo" column="reply_no" />
        <result property="boardNo" column="board_no" />
        <result property="writer" column="writer" />
        <result property="content" column="content" />
        <result property="regDate" column="reg_date" />
        <result property="parentReplyNo" column="parent_reply_no" />
    </resultMap>

    <!-- 게시글의 모든 댓글 조회 -->
    <select id="selectRepliesByBoardNo" parameterType="int" resultMap="ReplyResultMap">
        SELECT reply_no, board_no, writer, content, reg_date, parent_reply_no
        FROM t_reply
        WHERE board_no = #{boardNo}
        ORDER BY NVL(parent_reply_no, reply_no), reg_date ASC
    </select>

    <!-- 특정 댓글 조회 -->
    <select id="selectReplyByNo" parameterType="int" resultMap="ReplyResultMap">
        SELECT reply_no, board_no, writer, content, reg_date, parent_reply_no
        FROM t_reply
        WHERE reply_no = #{replyNo}
    </select>

    <!-- 댓글 추가 -->
    <insert id="insertReply" parameterType="kr.ac.kopo.vo.ReplyVO">
        INSERT INTO t_reply (reply_no, board_no, writer, content, reg_date, parent_reply_no)
        VALUES (seq_t_reply_no.nextval, #{boardNo}, #{writer}, #{content}, SYSDATE, #{parentReplyNo, jdbcType=INTEGER})
    </insert>

    <!-- 댓글 수정 -->
    <update id="updateReply" parameterType="kr.ac.kopo.vo.ReplyVO">
        UPDATE t_reply
        SET content = #{content}, reg_date = SYSDATE
        WHERE reply_no = #{replyNo}
    </update>

    <!-- 댓글 삭제 -->
    <delete id="deleteReply" parameterType="int">
        DELETE FROM t_reply
        WHERE reply_no = #{replyNo}
    </delete>

</mapper>